# Journal — 2026-02-15

## What I worked on
I focused on “closing the loop” from a high-level architecture into something I can physically wire and debug: compute-to-controller links, sensor I/O, motor driver control, and encoder signal conditioning. I iterated the communications diagram until it was wiring-ready (correct protocols, correct voltage domains, and explicit grounding).

---

## Topics covered

### 1) Updated compute + control split
- I decided to use the **BeagleBone Green Gateway** as the **base controller** (encoders + motor driver interface) to get to a working MVP faster.
- Jetson remains the “brains”: perception (OAK-D Lite), navigation stack, task logic, and the RoArm driver.

### 2) Finalized communications map (wiring-ready)
I converged on this structure:
- **Jetson → OAK-D Lite** over **USB 3.x** (bus-powered camera).
- **Jetson → RPLIDAR A1** over **USB-Serial** (simplest integration).
- **Jetson → RoArm-M2-S** over **USB-Serial @ 115200** (Waveshare ROS2 serial node).
- **Jetson ↔ BeagleBone** over **USB 2.0** (BeagleBone as USB client/gadget).
- **BeagleBone → Sabertooth** via **TTL serial 8N1** to **S1**, plus a dedicated **GPIO safety line** to **S2**, and common ground to **COM/0V**.

Key confirmations from manufacturer docs:
- OAK-D Lite is powered over USB-C and sends data to host via USB 3.1 Gen1.
- RPLIDAR A1 supports Serial/USB; UART is 3.3V-TTL @ 115200 and 8N1.
- RoArm-M2-S ROS2 serial node example uses `/dev/ttyUSB0` at 115200 and describes serial payloads as JSON.
- Sabertooth 2x60 supports TTL serial control and has S1/S2 signal terminals referenced to COM/0V.

### 3) Encoder wiring correction + signal conditioning
I corrected the diagram so “A/B” lines are clearly **encoder channels**, not motor control.

I added buffers/level shifting because:
- Pololu-style quadrature encoders output **A/B as 0 → Vcc**, and encoder Vcc can be 5V (or higher).
- BeagleBone GPIO is **3.3V logic**, so feeding 5V pulses directly into GPIO is not acceptable.

Decision:
- Power encoders at **5V**, then translate A/B into **3.3V** for BeagleBone inputs using a **buffer/translator** approach (not “I2C MOSFET shifters”).
- I leaned toward using an **8-channel buffer** (one chip handles all four wheels: A/B × 4 = 8 signals). A typical part class is **74LVC245A**, which is designed for **5V tolerant inputs** while operating at ~3.3V.

### 4) Sabertooth control + safety wiring cleanup
- I removed the incorrect idea of tying BeagleBone 5V to Sabertooth “5V”. The Sabertooth **5V terminal is a BEC output**, not something I should back-feed.
- I kept a dedicated **E-stop/stop control** path to **S2** and noted it should be wired **fail-safe** (default to “stop” on controller reboot).

### 5) USB power / reliability considerations
- I called out that the OAK-D Lite can exceed the USB2 current envelope and may need a Y-adapter or powered hub strategy depending on host port power.
- For “robot reliability,” I’m planning to keep USB cables short, strain relieved, and to consider a powered hub if I see dropouts.

### 6) FPGA learning plan adjustment (snickerdoodle vs alternatives)
- I recognized I still want FPGA learning, but for MVP speed I’m prioritizing BeagleBone Gateway for drivetrain control.
- I’ll keep snickerdoodle for a later “FPGA coprocessor” milestone (e.g., encoder decode / timestamping / safety gating), but not make it a blocker for MVP.

---

## Trade studies summarized

### A) Base controller: snickerdoodle vs BeagleBone vs ESP32
- **BeagleBone Green Gateway** won for MVP because it’s purpose-built for embedded I/O and has PRUs for real-time behavior, plus simple USB client connectivity.
- snickerdoodle remains the “FPGA learning” platform, but it’s a schedule risk if I make it the primary base controller immediately.
- ESP32 remains useful as a “sensor satellite,” but not my main drivetrain controller.

### B) Encoder level shifting: Pololu 2595-style vs buffer/translator IC
- “MOSFET bidirectional level shifters” can work in some situations, but encoder lines are noisy and edge-sensitive near motors.
- I chose the **buffer/translator** direction (e.g., 74LVC245A class) for stronger edges, better noise immunity, and a clean 8-channel implementation.

### C) LIDAR wiring: UART direct vs USB-Serial
- Direct UART is technically valid (3.3V-TTL @ 115200 8N1), but USB-Serial is the fastest to integrate and reduces wiring/level-shift complexity.

---

## Decisions made (current “frozen” plan)
- **Base controller:** BeagleBone Green Gateway for MVP.
- **Motor driver:** Sabertooth 2x60 controlled from BeagleBone via **TTL serial 8N1 to S1**; include **S2** stop line and common grounding to COM/0V.
- **Encoders:** power at **5V**, buffer down to **3.3V** into BeagleBone; implement as a consolidated **8-channel buffer**.
- **Arm:** keep RoArm directly on Jetson via USB-Serial at 115200 (Waveshare ROS2 serial node).
- **Perception:** OAK-D Lite on USB 3.x, with awareness of power draw and possible powered hub/Y-adapter needs.
- **Jetson↔BeagleBone:** USB 2.0 link (serial now; I can move to USB-network gadget later if I want an IP transport).

---

## Lessons learned
- Sabertooth’s “5V” terminal is not a required comms wire; it’s a power output (BEC). Don’t back-feed it.

---

## Open questions / next work
1. Pick the exact **encoder buffer implementation** (breakout board vs small custom PCB) and lock down the A/B mapping and connector style.
2. Define the **Jetson↔BeagleBone message protocol** (simple framed binary vs JSON, update rates, watchdog behavior).
3. Implement **PRU-based quadrature counting** (or kernel/GPIO-based first, then PRU upgrade).
4. Produce a **harness plan**: wire gauges, connector families, strain relief points, and a continuity-test checklist.
5. Validate Sabertooth settings (serial mode, baud rate, failsafe behavior) with a minimal bench test.

---

## Source links I referenced (for later)
```text
Sabertooth 2x60 User’s Guide (Dimension Engineering):
https://www.dimensionengineering.com/datasheets/Sabertooth2x60.pdf

RoArm-M2-S ROS2 Serial Communication Node (Waveshare):
https://www.waveshare.com/wiki/RoArm-M2-S_ROS2_Serial_Communication_Node

RPLIDAR UART spec (Digi-Key PDF):
https://www.digikey.com/htmldatasheets/production/1849011/0/0/1/rplidar-datasheet.pdf

OAK-D Lite Datasheet (Core Electronics mirror):
https://core-electronics.com.au/attachments/localcontent/OAK-D-Lite_Datasheet_16676646d51.pdf

OAK-D Lite power note (Reichelt PDF mirror):
https://cdn-reichelt.de/documents/datenblatt/C150/OAK-D-LITE_DATASHEET.pdf

Pololu 37D encoder electrical (PDF):
https://www.pololu.com/file/0J1736/pololu-37d-metal-gearmotors-rev-1-2.pdf

74LVC245A Datasheet (ST):
https://www.st.com/resource/en/datasheet/cd00002333.pdf

BeagleBone Green Gateway overview (Seeed):
https://wiki.seeedstudio.com/BeagleBone-Green-Gateway/
````
